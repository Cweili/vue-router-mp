(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{323:function(t,a,s){"use strict";s.r(a);var n=s(41),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"导航守卫"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导航守卫","aria-hidden":"true"}},[t._v("#")]),t._v(" 导航守卫")]),t._v(" "),s("p",[t._v("正如其名，"),s("code",[t._v("vue-router-mp")]),t._v(" 提供的导航守卫主要用来通过跳转或取消的方式守卫导航。有多种机会植入路由导航过程中：全局的, 单个路由独享的。")]),t._v(" "),s("h2",{attrs:{id:"全局守卫"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#全局守卫","aria-hidden":"true"}},[t._v("#")]),t._v(" 全局守卫")]),t._v(" "),s("p",[t._v("你可以使用 "),s("code",[t._v("router.beforeEach")]),t._v(" 注册一个全局前置守卫：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" router "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("VueRouter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nrouter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("beforeEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("当一个导航触发时，全局前置守卫按照创建顺序调用。守卫是异步解析执行，此时导航在所有守卫 resolve 完之前一直处于 "),s("strong",[t._v("等待中")]),t._v("。")]),t._v(" "),s("p",[t._v("每个守卫方法接收三个参数：")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[s("code",[t._v("to: Route")])]),t._v(": 即将要进入的目标 "),s("router-link",{attrs:{to:"/api/#路由对象"}},[t._v("路由对象")])],1)]),t._v(" "),s("li",[s("p",[s("strong",[s("code",[t._v("from: Route")])]),t._v(": 当前导航正要离开的路由")])]),t._v(" "),s("li",[s("p",[s("strong",[s("code",[t._v("next: Function")])]),t._v(": 一定要调用该方法来 "),s("strong",[t._v("resolve")]),t._v(" 这个钩子。执行效果依赖 "),s("code",[t._v("next")]),t._v(" 方法的调用参数。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[s("code",[t._v("next()")])]),t._v(": 进行管道中的下一个钩子。如果全部钩子执行完了，则导航的状态就是 "),s("strong",[t._v("confirmed")]),t._v(" (确认的)。")])]),t._v(" "),s("li",[s("p",[s("strong",[s("code",[t._v("next(false)")])]),t._v(": 中断当前的导航。如果浏览器的 URL 改变了 (可能是用户手动或者浏览器后退按钮)，那么 URL 地址会重置到 "),s("code",[t._v("from")]),t._v(" 路由对应的地址。")])]),t._v(" "),s("li",[s("p",[s("strong",[s("code",[t._v("next('/')")]),t._v(" 或者 "),s("code",[t._v("next({ path: '/' })")])]),t._v(": 跳转到一个不同的地址。当前的导航被中断，然后进行一个新的导航。你可以向 "),s("code",[t._v("next")]),t._v(" 传递任意位置对象，且允许设置诸如 "),s("code",[t._v("replace: true")]),t._v("、"),s("code",[t._v("name: 'home'")]),t._v(" 之类的选项以及任何用在 "),s("router-link",{attrs:{to:"/api/#router-push"}},[s("code",[t._v("router.push")])]),t._v(" 中的选项。")],1)]),t._v(" "),s("li",[s("p",[s("strong",[s("code",[t._v("next(error)")])]),t._v(": 如果传入 "),s("code",[t._v("next")]),t._v(" 的参数是一个 "),s("code",[t._v("Error")]),t._v(" 实例，则导航会被终止。")])])])])]),t._v(" "),s("p",[s("strong",[t._v("确保要调用 "),s("code",[t._v("next")]),t._v(" 方法，否则钩子就不会被 resolved。")])]),t._v(" "),s("h2",{attrs:{id:"全局后置钩子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#全局后置钩子","aria-hidden":"true"}},[t._v("#")]),t._v(" 全局后置钩子")]),t._v(" "),s("p",[t._v("你也可以注册全局后置钩子，然而和守卫不同的是，这些钩子不会接受 "),s("code",[t._v("next")]),t._v(" 函数也不会改变导航本身：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("router"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("afterEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"路由独享的守卫"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路由独享的守卫","aria-hidden":"true"}},[t._v("#")]),t._v(" 路由独享的守卫")]),t._v(" "),s("p",[t._v("你可以在路由配置上直接定义 "),s("code",[t._v("beforeEnter")]),t._v(" 守卫：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" router "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("VueRouter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  routes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/foo'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      component"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Foo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      beforeEnter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("这些守卫与全局前置守卫的方法参数是一样的。")]),t._v(" "),s("h2",{attrs:{id:"组件内的守卫"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组件内的守卫","aria-hidden":"true"}},[t._v("#")]),t._v(" 组件内的守卫")]),t._v(" "),s("p",[t._v("由于小程序并非单页应用，在路由跳转前无法完成页面组件的解析，因此“组件内的守卫”暂时无法实现")]),t._v(" "),s("h2",{attrs:{id:"完整的导航解析流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#完整的导航解析流程","aria-hidden":"true"}},[t._v("#")]),t._v(" 完整的导航解析流程")]),t._v(" "),s("ol",[s("li",[t._v("导航被触发。")]),t._v(" "),s("li",[t._v("在失活的组件里调用离开守卫。")]),t._v(" "),s("li",[t._v("调用全局的 "),s("code",[t._v("beforeEach")]),t._v(" 守卫。")]),t._v(" "),s("li",[t._v("在路由配置里调用 "),s("code",[t._v("beforeEnter")]),t._v("。")]),t._v(" "),s("li",[t._v("导航被确认。")]),t._v(" "),s("li",[t._v("调用全局的 "),s("code",[t._v("afterEach")]),t._v(" 钩子。")]),t._v(" "),s("li",[t._v("触发页面更新。")])]),t._v(" "),s("blockquote",[s("p",[t._v("对应 "),s("a",{attrs:{href:"https://router.vuejs.org/zh/guide/advanced/navigation-guards.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-router 文档"),s("OutboundLink")],1),t._v("。")])])])},[],!1,null,null,null);a.default=e.exports}}]);